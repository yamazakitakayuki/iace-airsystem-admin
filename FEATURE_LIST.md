# 航空券予約システム - 機能一覧

このドキュメントは、航空券予約システムの全機能を網羅した機能一覧です。
他のAIエージェントに本システムの機能を伝えるための参照用ドキュメントです。

## 📋 目次
- [プロジェクト概要](#プロジェクト概要)
- [システム構成](#システム構成)
- [ユーザー向けサイト機能](#ユーザー向けサイト機能)
- [管理画面機能](#管理画面機能)
- [技術スタック](#技術スタック)
- [データモデル](#データモデル)
- [未実装機能・今後の拡張](#未実装機能今後の拡張)

---

## プロジェクト概要

### システム名
**航空券予約システム (FlightSearch)**

### 目的
航空券の検索、予約、管理を行う包括的なWebアプリケーション

### 構成
本システムは2つのWebアプリケーションで構成されています：
1. **ユーザー向けサイト** (port 3000) - 一般ユーザーがフライトを検索・予約
2. **管理画面** (port 3001) - 管理者が予約・ユーザー・マスタデータを管理

### 開発環境URL
- **ユーザー向けサイト**: https://3000-ixum760vzlh6kn5x9qt8b-dfc00ec5.sandbox.novita.ai
- **管理画面**: https://3001-ixum760vzlh6kn5x9qt8b-dfc00ec5.sandbox.novita.ai

### GitHub リポジトリ
- **ユーザー向けサイト**: https://github.com/yamazakitakayuki/iace-airsystem
- **管理画面**: https://github.com/yamazakitakayuki/iace-airsystem-admin

### バックアップ
- **ユーザー向けサイト**: https://www.genspark.ai/api/files/s/5uxcqVFt (315 KB, 2026-02-12)
- **管理画面**: https://www.genspark.ai/api/files/s/NlztTWtz (156 KB, 2026-02-12)

---

## システム構成

### アーキテクチャ
```
┌─────────────────────────────────────────────────────────────┐
│                      インターネット                           │
└─────────────────────────────────────────────────────────────┘
                              │
                              │
        ┌─────────────────────┴─────────────────────┐
        │                                             │
        ▼                                             ▼
┌────────────────┐                          ┌────────────────┐
│  ユーザー向け   │                          │    管理画面     │
│   サイト        │                          │                │
│  (port 3000)   │                          │  (port 3001)   │
├────────────────┤                          ├────────────────┤
│ - フライト検索  │                          │ - 予約管理      │
│ - 予約フロー    │                          │ - ユーザー管理   │
│ - マイページ    │                          │ - マスタ管理    │
│ - 認証(OTP)    │                          │ - ダッシュボード │
└────────────────┘                          └────────────────┘
        │                                             │
        └─────────────────────┬─────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  データストレージ │
                    │   (モックデータ)  │
                    ├──────────────────┤
                    │ - JavaScript配列  │
                    │ - sessionStorage │
                    │   (一時保存)     │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │ 将来的な実装予定  │
                    ├──────────────────┤
                    │ - Cloudflare D1  │
                    │ - Amadeus API    │
                    │ - Stripe決済     │
                    │ - メール送信API   │
                    └──────────────────┘
```

### データフロー
```
ユーザー操作
    ↓
フロントエンド(HTML/CSS/JavaScript)
    ↓
Honoバックエンド(API Routes)
    ↓
データ処理(現在: メモリ内, 将来: D1 Database)
    ↓
レスポンス返却
    ↓
画面更新
```

---

## ユーザー向けサイト機能

### 1. フライト検索機能 ✅

#### 1.1 旅程タイプ選択
- **往復(Round Trip)**: 出発地→目的地→出発地
- **片道(One Way)**: 出発地→目的地のみ
- **複数都市(Multi-City)**: 複数区間を個別に指定
  - 最大5区間まで追加可能
  - 各区間ごとに出発地・目的地・日付を指定

#### 1.2 出発地・目的地入力
- **空港サジェスト機能**
  - 入力中にリアルタイムで空港候補を表示
  - 都市名・空港名・空港コード(IATA)で検索可能
  - 主要空港のダミーデータ実装済み
  - 例: 「東京」→「成田国際空港 (NRT)」「羽田空港 (HND)」

#### 1.3 日付選択
- **出発日**: カレンダーUIで選択
- **帰国日**: 往復の場合のみ
- **日付バリデーション**: 過去日付・論理矛盾のチェック

#### 1.4 乗客情報設定
- **乗客カテゴリー**:
  - 大人 (Adult): 12歳以上
  - 子供 (Child): 2-11歳
  - 幼児 (Infant): 2歳未満
- **座席クラス初期設定**:
  - エコノミー (Economy)
  - プレミアムエコノミー (Premium Economy)
  - ビジネス (Business)
  - ファースト (First)
- **人数設定**: 各カテゴリーごとに0-9名

#### 1.5 追加フィルター
- **航空会社テキストフィルター**: 航空会社名で絞り込み
- **直行便のみ**: チェックボックスで選択

#### 1.6 検索実行
- 「フライトを検索」ボタン
- 検索条件のバリデーション
- モックデータによる検索結果表示

---

### 2. 検索結果表示機能 ✅

#### 2.1 フライトカード表示
各フライトカードには以下の情報が表示されます:

**往路情報**
- 航空会社ロゴ (Google Flights CDN)
- フライト番号
- 出発空港・到着空港 (IATAコード + 都市名)
- 出発時刻・到着時刻
- 所要時間
- 経由地情報 (直行便/1回経由/2回以上経由)

**復路情報** (往復の場合)
- 往路と同様の情報

**価格情報**
- 1人あたりの往復価格
- 手荷物情報 (受託手荷物込み)
- 「選択する」ボタン

#### 2.2 航空会社ロゴ
- **ソース**: Google Flights CDN (gstatic.com)
- **URL形式**: `https://www.gstatic.com/flights/airline_logos/70px/{IATA_CODE}.png`
- **対応航空会社**:
  - ANA (NH): 全日空
  - JAL (JL): 日本航空
  - UA: ユナイテッド航空
  - DL: デルタ航空
  - AA: アメリカン航空
- **フォールバック**: ロゴ読み込み失敗時は航空会社コードを表示

#### 2.3 ダミーデータ
現在は以下のフライトデータをモック実装:
- 東京 ↔ ニューヨーク (JFK)
- 東京 ↔ サンフランシスコ (SFO)
- 東京 ↔ ロサンゼルス (LAX)
- 大阪 ↔ ニューヨーク (JFK)
- 複数の航空会社 (ANA, JAL, United, Delta, American)
- 価格帯: ¥80,000 - ¥350,000

---

### 3. フィルター・ソート機能 ✅

#### 3.1 価格帯フィルター
- スライダーUIで価格範囲を選択
- 最小価格: ¥0
- 最大価格: ¥500,000+
- リアルタイムで検索結果を絞り込み

#### 3.2 経由回数フィルター
- チェックボックスで選択:
  - 直行便
  - 1回経由
  - 2回以上経由
- 複数選択可能

#### 3.3 出発時間帯フィルター
- チェックボックスで選択:
  - 朝 (00:00 - 06:00)
  - 昼 (06:00 - 12:00)
  - 夕 (12:00 - 18:00)
  - 夜 (18:00 - 24:00)
- 複数選択可能

#### 3.4 航空会社フィルター
- チェックボックスで選択:
  - ANA
  - JAL
  - United
  - Delta
  - American
- 複数選択可能

#### 3.5 ソート機能
- **おすすめ順**: デフォルト (価格と所要時間のバランス)
- **最安値順**: 価格が安い順
- **最短時間順**: 所要時間が短い順
- **出発時間順**: 出発時刻が早い順

#### 3.6 フィルターリセット
- 「フィルターをリセット」ボタンで全フィルターを初期化

---

### 4. 座席クラス選択モーダル ✅

フライトカードの「選択する」ボタンをクリックすると表示されます。

#### 4.1 座席クラス選択
**往路便**
- エコノミー
- プレミアムエコノミー
- ビジネス
- ファースト

**復路便** (往復の場合)
- エコノミー
- プレミアムエコノミー
- ビジネス
- ファースト

#### 4.2 各座席クラスの詳細情報
**エコノミー**
- 価格倍率: 1.0x (基準価格)
- 残席数: 12席
- 機内サービス: 標準座席、機内食付き、受託手荷物 1個
- キャンセル条件: キャンセル料 50%

**プレミアムエコノミー**
- 価格倍率: 1.5x
- 残席数: 7席
- 機内サービス: 広々とした座席、優先搭乗、機内食付き、受託手荷物 2個
- キャンセル条件: キャンセル料 30%

**ビジネス**
- 価格倍率: 3.0x
- 残席数: 5席
- 機内サービス: フルフラットシート、ラウンジ利用、プレミアム機内食、受託手荷物 3個
- キャンセル条件: キャンセル料 20%

**ファースト**
- 価格倍率: 5.0x
- 残席数: 3席
- 機内サービス: プライベートスイート、ラウンジ利用、シェフ監修機内食、受託手荷物 無制限
- キャンセル条件: キャンセル無料

#### 4.3 リアルタイム料金計算
- 往路・復路の座席クラスに応じた料金を自動計算
- 乗客数を考慮した合計金額を表示
- 例: 基本料金 ¥80,000 × ビジネス(3.0x) + エコノミー(1.0x) = ¥320,000

#### 4.4 アクセシビリティ対応
- キーボード操作: Tab、Enter、Space、Escapeキー対応
- ARIA属性: スクリーンリーダー対応
- フォーカス管理: モーダル内外の適切なフォーカス制御

---

### 5. 認証選択画面 ✅

座席クラス選択後、「予約を続ける」ボタンをクリックすると表示されます。

#### 5.1 認証方法選択
3つの認証方法から選択:

**新規登録**
- ワンタイムパスワード(OTP)方式
- メールアドレスのみで登録
- パスワード管理不要

**ログイン**
- ワンタイムパスワード(OTP)方式
- メールアドレスでログイン
- パスワード不要

**ゲストで予約**
- 会員登録なしで予約
- 予約情報のみ入力
- マイページ機能は利用不可

#### 5.2 UI/UX
- 各選択肢が明確に区別されたボタンデザイン
- 戻るボタンで検索結果へ戻る
- スムーズな画面遷移

---

### 6. 新規登録機能 ✅

#### 6.1 ワンタイムパスワード(OTP)方式
パスワードを設定せず、メールアドレスのみで登録できるセキュアな認証方式です。

#### 6.2 登録フロー
**ステップ1: メールアドレス入力**
- メールアドレスフィールド
- 「確認コードを送信」ボタン
- メールアドレスのバリデーション

**ステップ2: 確認コード送信**
- 6桁の確認コードを生成
- メール送信(モック実装)
- コンソールに確認コード表示(開発用)
- 有効期限: 10分

**ステップ3: 確認コード入力**
- 6桁の確認コード入力フィールド
- 「確認する」ボタン
- 「再送信」ボタン(60秒後に有効化)
- カウントダウンタイマー表示

**ステップ4: 登録完了**
- セッションストレージに認証情報保存
- 予約フローへ自動遷移

#### 6.3 メール送信モック機能
現在はモック実装ですが、本番環境用に準備済み:
- コンソールにメール内容表示
- 確認コードの表示(開発用)
- メール本文フォーマット実装済み
- 統合予定API: SendGrid / Resend / Mailgun

#### 6.4 セキュリティ機能
- 確認コード有効期限: 10分
- 再送信クールダウン: 60秒
- メールアドレスバリデーション
- XSS対策: 入力値のサニタイズ

---

### 7. ログイン機能 ✅

#### 7.1 ワンタイムパスワード(OTP)方式
新規登録と同様の認証フローです。

#### 7.2 ログインフロー
**ステップ1: メールアドレス入力**
- メールアドレスフィールド
- 「ログインコードを送信」ボタン

**ステップ2: 確認コード送信**
- 6桁の確認コードを生成
- メール送信(モック実装)

**ステップ3: 確認コード入力**
- 6桁の確認コード入力
- 「ログイン」ボタン
- 「再送信」ボタン

**ステップ4: ログイン完了**
- セッションストレージに認証情報保存
- 予約フローへ自動遷移

#### 7.3 特徴
- パスワード忘れ機能不要
- ユーザー体験の簡素化
- セキュリティと利便性の両立

---

### 8. 予約確認画面(座席選択・お客様情報入力) ✅

認証完了後に表示される、予約詳細の入力画面です。

#### 8.1 選択済みフライト情報表示
**往路便**
- フライト番号
- 区間 (例: 東京 (NRT) → ニューヨーク (JFK))
- 座席クラス
- 料金

**復路便** (往復の場合)
- フライト番号
- 区間
- 座席クラス
- 料金

#### 8.2 座席選択機能(シートマップ)

**シートマップUI**
- 座席クラスに応じたシートマップ生成
- エコノミー: 3-4-3配置
- プレミアムエコノミー: 2-4-2配置
- ビジネス: 2-2-2配置
- ファースト: 1-2-1配置

**座席ステータス**
- 利用可能: 青色
- 選択済み: 緑色
- 利用不可: グレー
- 特別席: オレンジ色(追加料金あり)

**座席選択機能**
- クリックで座席を選択・解除
- 選択人数分の座席バリデーション
- 往路・復路合計で選択人数×2座席が必要
- 特別席の追加料金表示

**選択済み座席サマリー**
- 往路: 選択済み座席の一覧
- 復路: 選択済み座席の一覧
- 合計追加料金の表示

#### 8.3 お客様情報入力フォーム

**乗客情報** (人数分のフォーム自動生成)
- 姓 (Last Name)
- 名 (First Name)
- 性別 (Gender): 男性 / 女性 / その他
- 生年月日 (Date of Birth): YYYY-MM-DD形式
- パスポート番号 (Passport Number)
- 国籍 (Nationality): ドロップダウンリスト

**連絡先情報**
- メールアドレス (Email): 予約確認メール送信先
- 電話番号 (Phone Number): 国際形式対応

**緊急連絡先情報**
- 緊急連絡先氏名
- 緊急連絡先電話番号

**利用規約**
- 利用規約・プライバシーポリシー同意チェックボックス
- 必須項目

#### 8.4 最終料金計算・表示
- 全乗客分の基本料金
- 座席アップグレード料金(プレミアムエコノミー以上)
- 特別席料金
- リアルタイム合計金額表示

#### 8.5 バリデーション
- 必須項目の入力チェック
- 座席数の整合性チェック (選択人数 × 2区間)
- メールアドレス形式チェック
- パスポート番号形式チェック
- 生年月日の妥当性チェック

---

### 9. 予約内容の最終確認画面 ✅

全情報を確認し、決済へ進む前の最終チェック画面です。

#### 9.1 フライト情報サマリー
**往路便**
- 便名
- 区間 (都市名 + 空港コード)
- 座席クラス
- 選択済み座席

**復路便** (往復の場合)
- 便名
- 区間
- 座席クラス
- 選択済み座席

#### 9.2 乗客情報サマリー
全乗客の詳細情報を一覧表示:
- 氏名 (姓 名)
- 性別
- 生年月日
- パスポート番号
- 国籍

#### 9.3 連絡先情報サマリー
- メールアドレス
- 電話番号
- 緊急連絡先氏名
- 緊急連絡先電話番号

#### 9.4 お支払い合計金額
- 最終確認用の料金表示
- 乗客数の確認
- 税金・手数料を含む総額

#### 9.5 アクション
- 「戻る」ボタン: 座席選択画面へ戻る
- 「支払いへ進む」ボタン: 決済画面へ遷移

---

### 10. 決済画面(Stripe風) ✅

クレジットカード情報を入力し、支払いを完了する画面です。

#### 10.1 セキュリティ表示
- SSL/TLS暗号化表示
- 対応クレジットカードブランド表示:
  - Visa
  - MasterCard
  - American Express
  - JCB

#### 10.2 ご注文内容サマリー
- フライト料金 (基本料金)
- 座席アップグレード料金 (該当する場合)
- 税金・手数料
- 合計金額

#### 10.3 お支払い情報フォーム

**カード情報**
- カード番号: 16桁 (自動フォーマット: 4桁ずつ区切り)
- 有効期限: MM/YY形式 (自動フォーマット)
- セキュリティコード(CVV): 3-4桁
- カード名義人: ローマ字表記

**請求先住所**
- 郵便番号
- 都道府県
- 市区町村
- 番地・建物名

#### 10.4 バリデーション
- クレジットカード番号の形式チェック (Luhnアルゴリズム)
- 有効期限の妥当性チェック (過去日付不可)
- CVVの桁数チェック
- 必須項目の入力確認

#### 10.5 アクション
- 「キャンセル」ボタン: 予約確認画面へ戻る
- 「¥XXX を支払う」ボタン: 決済実行 (現在はモック)

#### 10.6 現在の実装状況
- ✅ UIフォーム実装済み
- ✅ バリデーション実装済み
- ❌ 実際の決済処理は未実装 (Stripe統合予定)
- ❌ 決済トークン管理未実装

---

### 11. 予約完了画面 ✅

決済完了後に表示される、予約完了の確認画面です。

#### 11.1 成功表示
- チェックマークアイコンのアニメーション
- 「予約が完了しました！」メッセージ
- 予約確認メール送信通知

#### 11.2 予約番号表示
- ユニーク予約番号 (自動生成)
  - 形式: BK + YYYYMMDD + 連番
  - 例: BK2026021001
- 予約番号の重要性の説明

#### 11.3 フライト情報サマリー
**往路便**
- 便名、区間、座席クラス
- 選択済み座席

**復路便** (往復の場合)
- 便名、区間、座席クラス
- 選択済み座席

**お支払い金額**
- 合計金額の再表示

#### 11.4 次のステップガイド
1. 予約確認メールを確認
2. オンラインチェックイン (出発24時間前から)
3. 空港へ出発 (出発2時間前まで)

#### 11.5 アクション
- 「予約確認書をダウンロード」ボタン (ダミー実装)
- 「検索トップに戻る」ボタン: 最初の検索画面へ戻る

---

### 12. マイページ機能 ✅

ログインユーザー専用の予約管理画面です。

#### 12.1 タブナビゲーション
- **予約履歴タブ**: 過去の予約一覧
- **会員情報タブ**: 登録情報の確認・編集

#### 12.2 予約履歴表示

**一覧表示**
全予約の一覧を時系列で表示:
- 予約番号
- 予約日
- ステータス (予約確認済み / 利用済み / キャンセル済み)
- 往路情報 (便名、区間、日時、座席クラス)
- 復路情報 (便名、区間、日時、座席クラス)
- 乗客数
- 合計金額
- 「詳細を見る」ボタン

**ステータスバッジ**
- 予約確認済み: 青色
- 利用済み: 緑色
- キャンセル済み: 赤色

#### 12.3 予約詳細モーダル

クリックすると予約の詳細情報をモーダル表示:

**フライト情報**
- 往路便: 便名、航空会社、座席番号、所要時間
- 復路便: 便名、航空会社、座席番号、所要時間

**乗客情報** (全員分)
- 氏名
- 性別
- 生年月日
- 国籍
- パスポート番号

**連絡先情報**
- メールアドレス
- 電話番号
- 緊急連絡先

**料金詳細**
- 基本料金
- 座席アップグレード料金
- 税金・手数料
- 合計金額

**ステータス**
- 現在の予約ステータス

#### 12.4 予約キャンセル機能

**キャンセルボタン**
- 予約詳細モーダル内に表示
- 「予約確認済み」ステータスのみキャンセル可能

**キャンセル確認モーダル**
- キャンセル確認メッセージ
- 注意事項の表示
- 「キャンセルする」ボタン
- 「戻る」ボタン

**キャンセル処理**
- ステータスを「キャンセル済み」に更新
- リスト再読み込み
- キャンセル確認メール送信(モック)

#### 12.5 会員情報編集

**表示項目**
- メールアドレス (表示のみ、変更不可)
- 氏名 (姓・名)
- 電話番号
- 生年月日
- 性別
- パスポート番号
- 国籍

**編集機能**
- 各項目を編集可能
- バリデーション付き
- 「保存」ボタン: 変更を保存
- 「キャンセル」ボタン: 編集を破棄

#### 12.6 ダミーデータ

開発用に以下のダミーデータを実装:
- 3件の予約履歴
  - 予約確認済み×2件
  - 利用済み×1件
- 完全な予約情報 (フライト、乗客、連絡先、料金)
- リアルな日付とフライト情報

---

### 13. UI/UX機能 ✅

#### 13.1 レスポンシブデザイン
- **デスクトップ**: 1280px以上
- **タブレット**: 768px - 1279px
- **モバイル**: 767px以下
- すべてのページでレスポンシブ対応

#### 13.2 スタイリング
- **TailwindCSS**: CDN経由で読み込み
- **Font Awesome**: アイコンライブラリ
- **カスタムCSS**: `/static/style.css`

#### 13.3 アニメーション効果
- **CSS Transition**: ボタンホバー、カード表示
- **CSS Animation**: チェックマークアニメーション、ローディング
- **スムーズスクロール**: ページ遷移

#### 13.4 キーボードナビゲーション
- **Tab**: フォーカス移動
- **Enter**: ボタン実行、選択確定
- **Space**: チェックボックス、ラジオボタンの切り替え
- **Escape**: モーダルを閉じる

#### 13.5 アクセシビリティ
- **ARIA属性**: スクリーンリーダー対応
- **フォーカス管理**: 適切なフォーカス順序
- **カラーコントラスト**: WCAG AA基準準拠
- **キーボード操作**: すべての機能をキーボードで操作可能

---

### 14. フッターリンク ✅

すべてのページのフッターに管理画面へのリンクを配置:

**リンク情報**
- テキスト: 「管理画面（モック）」
- アイコン: 盾アイコン (Font Awesome)
- 色: 青色 (text-blue-400)
- ホバー: 明るい青 (hover:text-blue-300)
- 動作: 新しいタブで管理画面を開く

**リンク先**
- URL: https://3001-ixum760vzlh6kn5x9qt8b-dfc00ec5.sandbox.novita.ai

---

## 管理画面機能

### 1. 管理者ログイン ✅

#### 1.1 ログイン画面
- **Email入力フィールド**
- **Password入力フィールド**
- **ログインボタン**

#### 1.2 デモ認証情報
- **Email**: admin@example.com
- **Password**: admin123

#### 1.3 認証処理
- 簡易的な認証チェック
- セッションストレージに認証情報保存
- ダッシュボードへリダイレクト

#### 1.4 セッション管理
- ログイン状態の保持
- ログアウト機能
- 未認証時のリダイレクト

---

### 2. ダッシュボード ✅

#### 2.1 統計カード表示

**本日の予約件数**
- アイコン: カレンダー
- 数値: 本日の予約件数
- 色: 青

**本日の売上**
- アイコン: 通貨
- 数値: 本日の売上金額
- 色: 緑

**今月の予約件数**
- アイコン: チャート
- 数値: 今月の予約件数
- 色: 紫

**今月の売上**
- アイコン: ウォレット
- 数値: 今月の売上金額
- 色: オレンジ

#### 2.2 最近の予約一覧

**表示項目**
- 予約番号
- ユーザー名
- 区間 (例: 東京 → ニューヨーク)
- 予約日
- ステータス
- 金額

**表示件数**
- 最新5件を表示
- 「すべて見る」リンクで予約管理画面へ遷移

#### 2.3 レスポンシブデザイン
- デスクトップ: 4カラム統計カード
- タブレット: 2カラム統計カード
- モバイル: 1カラム統計カード

---

### 3. サイドバーナビゲーション ✅

#### 3.1 ナビゲーションメニュー

**ダッシュボード**
- アイコン: ホーム
- リンク: ダッシュボード画面

**予約管理**
- アイコン: チケット
- リンク: 予約管理画面

**ユーザー管理**
- アイコン: ユーザー
- リンク: ユーザー管理画面

**マスタ管理**
- アイコン: データベース
- リンク: マスタ管理画面

**操作ログ**
- アイコン: クリップボード
- リンク: 操作ログ画面 (未実装)

#### 3.2 ログアウト
- ボタン位置: サイドバー下部
- アイコン: サインアウト
- 動作: セッション削除、ログイン画面へリダイレクト

---

### 4. 予約管理機能 ✅

#### 4.1 予約一覧表示

**テーブルカラム**
- 予約番号
- ユーザー名
- メールアドレス
- 区間 (例: 東京 → ニューヨーク)
- 出発日
- 予約日
- ステータス
- 金額

**ステータスバッジ**
- 予約確認済み: 青色
- キャンセル済み: 赤色
- 利用済み: 緑色

#### 4.2 検索・フィルター機能

**検索フィールド**
- 予約番号検索
- ユーザー名検索
- メールアドレス検索

**ステータスフィルター**
- すべて
- 予約確認済み
- キャンセル済み
- 利用済み

**リアルタイム検索**
- 入力中にリアルタイムで結果を絞り込み

#### 4.3 ソート機能
- 全カラムでソート可能
- 昇順/降順の切り替え
- ソート状態のアイコン表示

#### 4.4 CSV一括ダウンロード

**ボタン配置**
- 検索フィールドの右側

**エクスポート内容**
- 予約番号
- ユーザー名
- メールアドレス
- 区間
- 出発日
- 予約日
- ステータス
- 金額

**ファイル形式**
- ファイル名: `bookings_YYYY-MM-DD.csv`
- エンコーディング: UTF-8 BOM付き (Excel対応)

#### 4.5 予約詳細モーダル

**表示内容**

**フライト情報**
- 往路便: 便名、航空会社、区間、日時、座席クラス
- 復路便: 便名、航空会社、区間、日時、座席クラス

**乗客情報** (全員分)
- 氏名 (姓 名)
- 性別
- 生年月日
- 国籍
- パスポート番号

**連絡先情報**
- メールアドレス
- 電話番号
- 緊急連絡先氏名
- 緊急連絡先電話番号

**料金詳細**
- 基本料金
- 座席アップグレード料金
- 税金・手数料
- 合計金額

**予約情報**
- 予約番号
- 予約日
- ステータス

#### 4.6 予約キャンセル機能

**キャンセルボタン**
- 予約詳細モーダル内に表示
- 「予約確認済み」ステータスのみキャンセル可能

**キャンセル確認モーダル**
- 予約番号の確認
- 注意メッセージ
- 「キャンセルする」ボタン
- 「戻る」ボタン

**キャンセル処理**
- ステータスを「キャンセル済み」に更新
- 一覧を再読み込み
- キャンセル完了メッセージ表示

#### 4.7 ページネーション

**設定**
- 1ページあたり10件表示
- ページ番号表示 (最大7ページ分)
- 「前へ」「次へ」ボタン

**動作**
- ページ番号クリックで該当ページへ遷移
- 現在のページをハイライト表示

#### 4.8 ダミーデータ

10件の予約サンプルデータ:
- 予約番号: BK2026021001 - BK2026021010
- ユーザー: 様々な日本人名
- 区間: 東京↔ニューヨーク、大阪↔サンフランシスコ など
- 価格帯: ¥80,000 - ¥1,080,000

---

### 5. ユーザー管理機能 ✅

#### 5.1 ユーザー一覧表示

**テーブルカラム**
- メールアドレス
- 氏名
- 電話番号
- 登録日
- 最終ログイン
- ステータス
- 予約件数

**ステータスバッジ**
- アクティブ: 緑色
- 停止中: 赤色

#### 5.2 検索・フィルター機能

**検索フィールド**
- メールアドレス検索
- 氏名検索

**ステータスフィルター**
- すべて
- アクティブ
- 停止中

**リアルタイム検索**
- 入力中にリアルタイムで結果を絞り込み

#### 5.3 ソート機能
- 全カラムでソート可能
- 昇順/降順の切り替え
- ソート状態のアイコン表示

#### 5.4 CSV一括ダウンロード

**ボタン配置**
- 検索フィールドの右側

**エクスポート内容**
- メールアドレス
- 氏名
- 電話番号
- 登録日
- 最終ログイン
- ステータス
- 予約件数

**ファイル形式**
- ファイル名: `users_YYYY-MM-DD.csv`
- エンコーディング: UTF-8 BOM付き (Excel対応)

#### 5.5 ユーザー詳細モーダル

**表示内容**

**基本情報**
- メールアドレス
- 氏名 (姓 名)
- 電話番号

**パスポート情報**
- パスポート番号
- 国籍

**アカウント情報**
- 登録日
- 最終ログイン
- ステータス (アクティブ / 停止中)
- 予約件数

**予約履歴**
- 予約番号
- 区間
- 出発日
- ステータス
- 金額
- 全予約を一覧表示

#### 5.6 アカウント停止/再開機能

**停止ボタン**
- ユーザー詳細モーダル内に表示
- 「アクティブ」ステータスのユーザーのみ表示

**再開ボタン**
- ユーザー詳細モーダル内に表示
- 「停止中」ステータスのユーザーのみ表示

**停止確認モーダル**
- ユーザーのメールアドレス確認
- 注意メッセージ
- 「停止する」ボタン
- 「キャンセル」ボタン

**再開確認モーダル**
- ユーザーのメールアドレス確認
- 「再開する」ボタン
- 「キャンセル」ボタン

**処理**
- ステータスを更新
- 一覧を再読み込み
- 完了メッセージ表示

#### 5.7 ページネーション

**設定**
- 1ページあたり10件表示
- ページ番号表示 (最大7ページ分)
- 「前へ」「次へ」ボタン

#### 5.8 ダミーデータ

8件のユーザーサンプルデータ:
- メールアドレス: yamada@example.com など
- 氏名: 山田太郎、佐藤花子 など
- 予約件数: 0-5件
- ステータス: アクティブ / 停止中

---

### 6. マスタ管理機能 ✅

#### 6.1 タブ切り替え

**3つのマスタタブ**
- 都市マスタ
- 空港マスタ
- 航空会社マスタ

**タブUI**
- アクティブタブのハイライト表示
- クリックでタブ切り替え
- 各タブに対応するデータ表示

---

### 6.2 都市マスタ

#### 6.2.1 一覧表示

**テーブルカラム**
- 都市コード (例: TYO)
- 日本語名 (例: 東京)
- 英語名 (例: Tokyo)
- 国名 (例: 日本)
- 操作 (編集・削除ボタン)

#### 6.2.2 検索・フィルター
- 都市名検索 (日本語・英語)
- 都市コード検索
- 国名検索

#### 6.2.3 ソート機能
- 全カラムでソート可能
- 昇順/降順の切り替え

#### 6.2.4 CSV出力
- ファイル名: `cities_YYYY-MM-DD.csv`
- エンコーディング: UTF-8 BOM付き

#### 6.2.5 追加・編集・削除

**追加モーダル**
- 都市コード入力
- 日本語名入力
- 英語名入力
- 国名入力
- バリデーション付き

**編集モーダル**
- 既存データの編集
- 都市コードは編集不可

**削除確認モーダル**
- 都市名の確認
- 削除注意メッセージ

#### 6.2.6 ダミーデータ

10件の都市データ:
- TYO (東京, Tokyo, 日本)
- OSA (大阪, Osaka, 日本)
- NYC (ニューヨーク, New York, アメリカ)
- LAX (ロサンゼルス, Los Angeles, アメリカ)
- SFO (サンフランシスコ, San Francisco, アメリカ)
- CHI (シカゴ, Chicago, アメリカ)
- LON (ロンドン, London, イギリス)
- PAR (パリ, Paris, フランス)
- SEL (ソウル, Seoul, 韓国)
- SIN (シンガポール, Singapore, シンガポール)

---

### 6.3 空港マスタ

#### 6.3.1 一覧表示

**テーブルカラム**
- 空港コード (例: NRT)
- 日本語名 (例: 成田国際空港)
- 英語名 (例: Narita International Airport)
- 都市名 (例: 東京)
- 国名 (例: 日本)
- 操作 (編集・削除ボタン)

#### 6.3.2 検索・フィルター
- 空港コード検索
- 空港名検索 (日本語・英語)
- 都市名検索

#### 6.3.3 ソート機能
- 全カラムでソート可能
- 昇順/降順の切り替え

#### 6.3.4 CSV出力
- ファイル名: `airports_YYYY-MM-DD.csv`
- エンコーディング: UTF-8 BOM付き

#### 6.3.5 追加・編集・削除

**追加モーダル**
- 空港コード入力
- 日本語名入力
- 英語名入力
- 都市選択 (ドロップダウン)
- 国名入力
- バリデーション付き

**編集モーダル**
- 既存データの編集
- 空港コードは編集不可

**削除確認モーダル**
- 空港名の確認
- 削除注意メッセージ

#### 6.3.6 ダミーデータ

13件の空港データ:
- NRT (成田国際空港, Narita International Airport, 東京, 日本)
- HND (羽田空港, Haneda Airport, 東京, 日本)
- KIX (関西国際空港, Kansai International Airport, 大阪, 日本)
- ITM (大阪国際空港, Osaka International Airport, 大阪, 日本)
- JFK (ジョン・F・ケネディ国際空港, John F. Kennedy International Airport, ニューヨーク, アメリカ)
- EWR (ニューアーク・リバティ国際空港, Newark Liberty International Airport, ニューヨーク, アメリカ)
- LAX (ロサンゼルス国際空港, Los Angeles International Airport, ロサンゼルス, アメリカ)
- SFO (サンフランシスコ国際空港, San Francisco International Airport, サンフランシスコ, アメリカ)
- ORD (オヘア国際空港, O'Hare International Airport, シカゴ, アメリカ)
- LHR (ヒースロー空港, Heathrow Airport, ロンドン, イギリス)
- CDG (シャルル・ド・ゴール空港, Charles de Gaulle Airport, パリ, フランス)
- ICN (仁川国際空港, Incheon International Airport, ソウル, 韓国)
- SIN (チャンギ国際空港, Changi Airport, シンガポール, シンガポール)

---

### 6.4 航空会社マスタ

#### 6.4.1 一覧表示

**テーブルカラム**
- 航空会社コード (例: NH)
- 日本語名 (例: 全日空)
- 英語名 (例: All Nippon Airways)
- 国名 (例: 日本)
- 操作 (編集・削除ボタン)

#### 6.4.2 検索・フィルター
- 航空会社コード検索
- 航空会社名検索 (日本語・英語)

#### 6.4.3 ソート機能
- 全カラムでソート可能
- 昇順/降順の切り替え

#### 6.4.4 CSV出力
- ファイル名: `airlines_YYYY-MM-DD.csv`
- エンコーディング: UTF-8 BOM付き

#### 6.4.5 追加・編集・削除

**追加モーダル**
- 航空会社コード入力
- 日本語名入力
- 英語名入力
- 国名入力
- バリデーション付き

**編集モーダル**
- 既存データの編集
- 航空会社コードは編集不可

**削除確認モーダル**
- 航空会社名の確認
- 削除注意メッセージ

#### 6.4.6 ダミーデータ

10件の航空会社データ:
- NH (全日空, All Nippon Airways, 日本)
- JL (日本航空, Japan Airlines, 日本)
- AA (アメリカン航空, American Airlines, アメリカ)
- UA (ユナイテッド航空, United Airlines, アメリカ)
- DL (デルタ航空, Delta Air Lines, アメリカ)
- BA (ブリティッシュ・エアウェイズ, British Airways, イギリス)
- AF (エールフランス, Air France, フランス)
- KE (大韓航空, Korean Air, 韓国)
- SQ (シンガポール航空, Singapore Airlines, シンガポール)
- LH (ルフトハンザドイツ航空, Lufthansa, ドイツ)

---

### 7. 操作ログ機能 ⚠️ 未実装

将来実装予定の機能です。

#### 7.1 機能概要 (予定)
- 管理者の操作履歴を記録
- 日時、管理者、操作内容、対象データを表示
- 検索・フィルター機能
- CSV出力機能

---

## 技術スタック

### フロントエンド

#### ユーザー向けサイト
- **フレームワーク**: Hono JSX (サーバーサイドレンダリング)
- **スタイル**: TailwindCSS (CDN)
- **アイコン**: Font Awesome (CDN)
- **JavaScript**: Vanilla JavaScript (`/static/app.js`, 98KB)
- **CSS**: カスタムCSS (`/static/style.css`, 11KB)

#### 管理画面
- **フレームワーク**: Hono JSX (サーバーサイドレンダリング)
- **スタイル**: TailwindCSS (CDN)
- **アイコン**: Font Awesome (CDN)
- **JavaScript**: Vanilla JavaScript (`/static/admin.js`, 69KB)
- **CSS**: カスタムCSS (`/static/style.css`, 1.9KB)

### バックエンド

#### 共通
- **フレームワーク**: Hono (TypeScript)
- **ランタイム**: Cloudflare Workers
- **ビルドツール**: Vite
- **TypeScript**: 5.x
- **Package Manager**: npm

### デプロイメント

#### 開発環境
- **プラットフォーム**: Sandbox (Novita)
- **プロセス管理**: PM2
- **ポート**: 
  - ユーザー向けサイト: 3000
  - 管理画面: 3001

#### 本番環境 (予定)
- **プラットフォーム**: Cloudflare Pages
- **CDN**: Cloudflare Edge Network
- **ドメイン**: 未設定

### データストレージ

#### 現在の実装
- **データ保存**: JavaScript配列 (メモリ内)
- **セッション管理**: sessionStorage (ブラウザ)
- **永続化**: なし (ページリロードで消失)

#### 将来的な実装予定
- **Cloudflare D1**: SQLiteベースのリレーショナルデータベース
- **Cloudflare KV**: キーバリューストア (セッション、キャッシュ)
- **Amadeus API**: フライトデータの取得元
- **Stripe**: 決済処理
- **SendGrid/Resend**: メール送信

---

## データモデル

### ユーザー向けサイト

#### SearchCriteria (検索条件)
```javascript
{
  tripType: "roundtrip" | "oneway" | "multicity",
  from: "TYO",                    // 出発地 (IATAコード)
  to: "JFK",                      // 目的地 (IATAコード)
  departureDate: "2026-02-16",    // 出発日 (YYYY-MM-DD)
  returnDate: "2026-02-23",       // 帰国日 (YYYY-MM-DD) - 往復のみ
  passengers: {
    adults: 1,                    // 大人
    children: 0,                  // 子供
    infants: 0                    // 幼児
  },
  cabinClass: "economy",          // 座席クラス初期値
  directFlights: false,           // 直行便のみ
  airline: ""                     // 航空会社フィルター
}
```

#### FlightResult (検索結果)
```javascript
{
  flightNumber: "AA101",
  airline: {
    name: "アメリカン航空",
    code: "AA",
    logo: "https://www.gstatic.com/flights/airline_logos/70px/AA.png"
  },
  route: {
    from: "TYO",
    to: "JFK",
    fromCity: "東京",
    toCity: "ニューヨーク"
  },
  outbound: {
    departure: "08:00",
    arrival: "21:00",
    duration: "13時間00分",
    date: "2026-02-16"
  },
  return: {
    departure: "21:00",
    arrival: "08:00",
    duration: "13時間00分",
    date: "2026-02-23"
  },
  stops: {
    type: "direct",               // direct, 1-stop, 2-stops
    label: "直行便"
  },
  price: 80000                    // 基本価格 (1人あたり)
}
```

#### SeatClass (座席クラス)
```javascript
{
  economy: {
    name: "エコノミー",
    amenities: ["標準座席", "機内食付き", "受託手荷物 1個"],
    cancellation: "キャンセル料: 50%",
    priceMultiplier: 1.0,
    seatsAvailable: 12
  },
  premium_economy: {
    name: "プレミアムエコノミー",
    amenities: ["広々とした座席", "優先搭乗", "機内食付き", "受託手荷物 2個"],
    cancellation: "キャンセル料: 30%",
    priceMultiplier: 1.5,
    seatsAvailable: 7
  },
  business: {
    name: "ビジネス",
    amenities: ["フルフラットシート", "ラウンジ利用", "プレミアム機内食", "受託手荷物 3個"],
    cancellation: "キャンセル料: 20%",
    priceMultiplier: 3.0,
    seatsAvailable: 5
  },
  first: {
    name: "ファースト",
    amenities: ["プライベートスイート", "ラウンジ利用", "シェフ監修機内食", "受託手荷物 無制限"],
    cancellation: "キャンセル無料",
    priceMultiplier: 5.0,
    seatsAvailable: 3
  }
}
```

#### BookingData (予約データ)
```javascript
{
  bookingNumber: "BK2026021001",  // 予約番号
  bookingDate: "2026-02-10",      // 予約日
  status: "confirmed",            // confirmed, used, cancelled
  
  flight: {
    flightNumber: "AA101",
    basePrice: 80000,
    route: {
      from: "TYO",
      to: "JFK",
      fromCity: "東京",
      toCity: "ニューヨーク"
    }
  },
  
  seatClasses: {
    outbound: {
      class: "business",
      className: "ビジネス",
      price: 240000
    },
    return: {
      class: "economy",
      className: "エコノミー",
      price: 80000
    }
  },
  
  selectedSeats: {
    outbound: [
      { seatId: "outbound-5A", row: "5", column: "A", price: 0 }
    ],
    return: [
      { seatId: "return-18B", row: "18", column: "B", price: 21009 }
    ]
  },
  
  passengers: [
    {
      index: 1,
      lastName: "山田",
      firstName: "太郎",
      gender: "male",
      dob: "1990-01-01",
      passport: "TK1234567",
      nationality: "JP",
      category: "adult"
    }
  ],
  
  contact: {
    email: "example@email.com",
    phone: "090-1234-5678",
    emergencyName: "山田 花子",
    emergencyPhone: "090-9876-5432"
  },
  
  payment: {
    cardNumber: "************1234",
    cardHolder: "TARO YAMADA",
    amount: 341009
  },
  
  totalPrice: 341009
}
```

#### UserData (ユーザーデータ)
```javascript
{
  email: "user@example.com",
  lastName: "山田",
  firstName: "太郎",
  phone: "090-1234-5678",
  dob: "1990-01-01",
  gender: "male",
  passport: "TK1234567",
  nationality: "JP",
  registeredAt: "2026-01-15",
  lastLogin: "2026-02-10",
  bookings: [
    // BookingDataの配列
  ]
}
```

### 管理画面

#### AdminUser (管理者)
```javascript
{
  email: "admin@example.com",
  password: "admin123",      // 本番環境ではハッシュ化必須
  role: "admin",
  name: "管理者"
}
```

#### DashboardStats (ダッシュボード統計)
```javascript
{
  todayBookings: 15,           // 本日の予約件数
  todaySales: 3500000,         // 本日の売上
  monthBookings: 235,          // 今月の予約件数
  monthSales: 52000000,        // 今月の売上
  recentBookings: [            // 最近の予約5件
    // BookingDataの配列
  ]
}
```

#### City (都市マスタ)
```javascript
{
  code: "TYO",                 // 都市コード (IATA)
  nameJa: "東京",
  nameEn: "Tokyo",
  country: "日本"
}
```

#### Airport (空港マスタ)
```javascript
{
  code: "NRT",                 // 空港コード (IATA)
  nameJa: "成田国際空港",
  nameEn: "Narita International Airport",
  cityCode: "TYO",
  cityName: "東京",
  country: "日本"
}
```

#### Airline (航空会社マスタ)
```javascript
{
  code: "NH",                  // 航空会社コード (IATA)
  nameJa: "全日空",
  nameEn: "All Nippon Airways",
  country: "日本"
}
```

#### OperationLog (操作ログ) - 未実装
```javascript
{
  timestamp: "2026-02-10 14:30:00",
  admin: "admin@example.com",
  action: "cancel_booking",
  target: "BK2026021001",
  details: "予約をキャンセルしました"
}
```

---

## 未実装機能・今後の拡張

### Phase 1: Amadeus API統合 (優先度: 高)

#### 1.1 フライト検索API統合
- Amadeus Flight Offers Search API
- リアルタイムのフライトデータ取得
- 価格、在庫、スケジュールの最新情報

#### 1.2 フライトオファーAPI統合
- Amadeus Flight Offers Price API
- 正確な価格計算
- 座席クラスごとの価格取得

#### 1.3 予約作成API統合
- Amadeus Flight Create Orders API
- 実際の予約作成
- 予約番号(PNR)の発行

#### 1.4 環境変数設定
- AMADEUS_API_KEY
- AMADEUS_API_SECRET
- AMADEUS_ENDPOINT

---

### Phase 2: データベース実装 (優先度: 高)

#### 2.1 Cloudflare D1データベース作成
- SQLiteベースのグローバル分散データベース
- エッジロケーションでの高速アクセス

#### 2.2 マイグレーションファイル作成

**users テーブル**
```sql
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  email TEXT UNIQUE NOT NULL,
  last_name TEXT NOT NULL,
  first_name TEXT NOT NULL,
  phone TEXT,
  dob TEXT,
  gender TEXT,
  passport TEXT,
  nationality TEXT,
  registered_at TEXT DEFAULT CURRENT_TIMESTAMP,
  last_login TEXT,
  status TEXT DEFAULT 'active'
);
```

**bookings テーブル**
```sql
CREATE TABLE bookings (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  booking_number TEXT UNIQUE NOT NULL,
  user_id INTEGER,
  flight_number TEXT NOT NULL,
  route_from TEXT NOT NULL,
  route_to TEXT NOT NULL,
  departure_date TEXT NOT NULL,
  return_date TEXT,
  booking_date TEXT DEFAULT CURRENT_TIMESTAMP,
  status TEXT DEFAULT 'confirmed',
  total_price INTEGER NOT NULL,
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

**passengers テーブル**
```sql
CREATE TABLE passengers (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  booking_id INTEGER NOT NULL,
  last_name TEXT NOT NULL,
  first_name TEXT NOT NULL,
  gender TEXT NOT NULL,
  dob TEXT NOT NULL,
  passport TEXT NOT NULL,
  nationality TEXT NOT NULL,
  category TEXT NOT NULL,
  FOREIGN KEY (booking_id) REFERENCES bookings(id)
);
```

**seats テーブル**
```sql
CREATE TABLE seats (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  booking_id INTEGER NOT NULL,
  passenger_id INTEGER NOT NULL,
  leg TEXT NOT NULL,
  seat_id TEXT NOT NULL,
  seat_row TEXT NOT NULL,
  seat_column TEXT NOT NULL,
  price INTEGER DEFAULT 0,
  FOREIGN KEY (booking_id) REFERENCES bookings(id),
  FOREIGN KEY (passenger_id) REFERENCES passengers(id)
);
```

**payments テーブル**
```sql
CREATE TABLE payments (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  booking_id INTEGER NOT NULL,
  amount INTEGER NOT NULL,
  card_last4 TEXT NOT NULL,
  card_holder TEXT NOT NULL,
  payment_date TEXT DEFAULT CURRENT_TIMESTAMP,
  status TEXT DEFAULT 'completed',
  FOREIGN KEY (booking_id) REFERENCES bookings(id)
);
```

#### 2.3 データベース統合
- Hono APIルートでD1データベースにアクセス
- CRUD操作の実装
- トランザクション処理

#### 2.4 バックアップ・リストア機能
- 定期的な自動バックアップ
- 手動バックアップ機能
- リストア機能

---

### Phase 3: 認証・決済機能 (優先度: 中)

#### 3.1 ユーザー認証
- **Auth0**: エンタープライズグレードの認証サービス
- **Clerk**: モダンなユーザー認証
- ワンタイムパスワード(OTP)の本番実装

#### 3.2 Stripe決済統合
- Stripe Payment Intent API
- クレジットカード決済処理
- 3Dセキュア対応
- 決済トークン管理
- Webhook処理

#### 3.3 予約確認メール送信
- **SendGrid**: メール配信サービス
- **Resend**: モダンなメールAPI
- **Mailgun**: 大規模メール配信
- 予約確認メールテンプレート
- キャンセル確認メールテンプレート

#### 3.4 決済履歴・領収書発行
- 決済履歴の表示
- PDF領収書の生成
- 領収書のダウンロード

---

### Phase 4: 追加機能 (優先度: 低)

#### 4.1 予約変更・キャンセル機能
- オンラインでの予約変更
- 座席変更
- 日付変更
- キャンセル料金の自動計算

#### 4.2 オンラインチェックイン
- 出発24時間前からチェックイン可能
- 座席変更
- モバイル搭乗券の発行

#### 4.3 多言語対応
- 英語
- 中国語（簡体字・繁体字）
- 韓国語
- i18nライブラリの導入

#### 4.4 通貨選択機能
- USD (米ドル)
- EUR (ユーロ)
- CNY (人民元)
- KRW (韓国ウォン)
- リアルタイム為替レート取得

#### 4.5 PDFチケット生成機能
- 予約確認書PDF生成
- 搭乗券PDF生成
- QRコード埋め込み

#### 4.6 プッシュ通知
- フライト変更通知
- 遅延通知
- チェックインリマインダー
- Web Push API / FCM

---

### Phase 5: 管理機能拡張 (優先度: 低)

#### 5.1 操作ログ機能
- 管理者操作の記録
- 日時、管理者、操作内容、対象データ
- 検索・フィルター機能
- CSV出力機能

#### 5.2 売上レポート
- 日次売上レポート
- 月次売上レポート
- 航空会社別売上
- 路線別売上
- グラフ・チャート表示

#### 5.3 システムログ・監視
- アクセスログ
- エラーログ
- パフォーマンスモニタリング
- アラート機能

#### 5.4 メール配信管理
- メールテンプレート編集
- 配信履歴
- 配信ステータス確認

---

## プロジェクト構造

### ユーザー向けサイト (/home/user/webapp)
```
webapp/
├── src/
│   ├── index.tsx              # メインアプリケーション (Hono)
│   └── renderer.tsx           # レイアウト
├── public/
│   └── static/
│       ├── app.js             # フロントエンドJavaScript (98KB)
│       └── style.css          # カスタムCSS (11KB)
├── dist/                      # ビルド出力
│   ├── _worker.js             # Cloudflare Workers用
│   └── _routes.json           # ルーティング設定
├── ecosystem.config.cjs       # PM2設定
├── package.json               # 依存関係
├── tsconfig.json              # TypeScript設定
├── vite.config.ts             # Vite設定
├── wrangler.jsonc             # Cloudflare設定
├── .gitignore                 # Git除外設定
└── README.md                  # プロジェクト説明
```

### 管理画面 (/home/user/admin-webapp)
```
admin-webapp/
├── src/
│   ├── index.tsx              # メインアプリケーション (Hono)
│   └── renderer.tsx           # レイアウト
├── public/
│   └── static/
│       ├── admin.js           # フロントエンドJavaScript (69KB)
│       └── style.css          # カスタムCSS (1.9KB)
├── dist/                      # ビルド出力
│   ├── _worker.js             # Cloudflare Workers用
│   └── _routes.json           # ルーティング設定
├── ecosystem.config.cjs       # PM2設定
├── package.json               # 依存関係
├── tsconfig.json              # TypeScript設定
├── vite.config.ts             # Vite設定
├── wrangler.jsonc             # Cloudflare設定
├── .gitignore                 # Git除外設定
└── README.md                  # プロジェクト説明
```

---

## 開発コマンド

### ユーザー向けサイト

```bash
# プロジェクトディレクトリへ移動
cd /home/user/webapp

# 依存関係のインストール
npm install

# ビルド
npm run build

# 開発サーバー起動（PM2）
pm2 start ecosystem.config.cjs

# PM2管理
pm2 list                       # サービス一覧
pm2 logs webapp --nostream     # ログ確認
pm2 restart webapp             # 再起動
pm2 delete webapp              # サービス削除

# ポートクリーンアップ
fuser -k 3000/tcp

# サービステスト
curl http://localhost:3000
```

### 管理画面

```bash
# プロジェクトディレクトリへ移動
cd /home/user/admin-webapp

# 依存関係のインストール
npm install

# ビルド
npm run build

# 開発サーバー起動（PM2）
pm2 start ecosystem.config.cjs

# PM2管理
pm2 list                             # サービス一覧
pm2 logs admin-webapp --nostream     # ログ確認
pm2 restart admin-webapp             # 再起動
pm2 delete admin-webapp              # サービス削除

# ポートクリーンアップ
fuser -k 3001/tcp

# サービステスト
curl http://localhost:3001
```

---

## 復元方法

### GitHubから復元

```bash
# ユーザー向けサイト
git clone https://github.com/yamazakitakayuki/iace-airsystem.git webapp
cd webapp
npm install
npm run build
pm2 start ecosystem.config.cjs

# 管理画面
git clone https://github.com/yamazakitakayuki/iace-airsystem-admin.git admin-webapp
cd admin-webapp
npm install
npm run build
pm2 start ecosystem.config.cjs
```

### バックアップから復元

```bash
# ユーザー向けサイト
wget https://www.genspark.ai/api/files/s/5uxcqVFt -O user_backup.tar.gz
tar -xzf user_backup.tar.gz
cd webapp
npm install
npm run build
pm2 start ecosystem.config.cjs

# 管理画面
wget https://www.genspark.ai/api/files/s/NlztTWtz -O admin_backup.tar.gz
tar -xzf admin_backup.tar.gz
cd admin-webapp
npm install
npm run build
pm2 start ecosystem.config.cjs
```

---

## まとめ

### 実装済み機能
✅ ユーザー向けサイト: フライト検索、座席選択、予約フロー、マイページ
✅ 管理画面: ダッシュボード、予約管理、ユーザー管理、マスタ管理

### 未実装機能
❌ Amadeus API統合
❌ Cloudflare D1データベース
❌ 実際の決済処理 (Stripe)
❌ メール送信機能
❌ 操作ログ機能

### 技術的な制約
- 現在はモックデータのみ
- ページリロードでデータ消失
- 実際の決済処理なし
- メール送信なし

### 今後の開発方針
1. Amadeus API統合でリアルデータ取得
2. Cloudflare D1でデータ永続化
3. Stripe決済統合
4. メール送信機能実装
5. 操作ログ機能追加

---

**最終更新日**: 2026-02-12

このドキュメントは、本システムの全機能を網羅しています。
他のAIエージェントに機能を伝える際は、このドキュメントを共有してください。
